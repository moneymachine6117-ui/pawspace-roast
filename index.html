<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PawSpace ‚Äì Roast Your Pet</title>

  <style>
    body {
      margin: 0;
      background: #0b0b0f;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 360px;
      text-align: center;
    }

    h2 {
      margin-bottom: 12px;
    }

    input[type="file"] {
      margin-bottom: 6px;
      color: white;
    }

    .disclaimer {
      font-size: 12px;
      opacity: 0.6;
      margin-bottom: 16px;
    }

    .card {
      display: none;
      background: linear-gradient(180deg, #12121a, #0b0b0f);
      border-radius: 28px;
      overflow: hidden;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
    }

    .image-wrap {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #1a1a24;
    }

    .image-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .content {
      padding: 20px;
    }

    .roast {
      font-size: 22px;
      font-weight: 800;
      line-height: 1.25;
      margin-bottom: 12px;
    }

    .footer {
      font-size: 11px;
      opacity: 0.75;
      letter-spacing: 0.4px;
    }

    .footer .cta {
      font-weight: 700;
    }

    button {
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
    }

    .primary {
      background: white;
      color: black;
    }

    .secondary {
      background: transparent;
      color: #aaa;
      border: 1px solid #333;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Upload your pet üêæ</h2>

    <input type="file" accept="image/*" id="upload" />
    <div class="disclaimer">
      Upload only pet images. Illegal or inappropriate content may be removed.
    </div>

    <div class="card" id="card">
      <div class="image-wrap">
        <img id="petImage" crossorigin="anonymous" />
      </div>
      <div class="content">
        <div class="roast" id="roastText"></div>
        <div class="footer">
          PAWSPACE ¬∑ Roast your pet ‚Üí
          <span class="cta">pawspace.vercel.app</span>
        </div>
      </div>
    </div>

    <button class="primary" id="generateBtn">Generate Roast</button>
    <button class="primary" id="downloadBtn" style="display:none;">
      Download Card
    </button>
    <button class="secondary" id="reportBtn" style="display:none;">
      Report Image
    </button>
  </div>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- APP SCRIPT -->
  <script>
    /* ---------- DATA ---------- */
    const fallbackRoasts = [
      "Looks calm. Definitely commits crimes when no one‚Äôs watching.",
      "Runs on vibes and bad decisions.",
      "Emotionally unavailable but demands attention.",
      "Acts innocent. Knows exactly what it‚Äôs doing.",
      "One brain cell. Still in charge."
    ];

    /* ---------- ELEMENTS ---------- */
    const upload = document.getElementById("upload");
    const petImage = document.getElementById("petImage");
    const card = document.getElementById("card");
    const roastText = document.getElementById("roastText");
    const generateBtn = document.getElementById("generateBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const reportBtn = document.getElementById("reportBtn");

    /* ---------- IMAGE PREVIEW ---------- */
    upload.addEventListener("change", () => {
      const file = upload.files[0];
      if (!file) return;
      petImage.src = URL.createObjectURL(file);
    });

    /* ---------- FETCH ROAST ---------- */
    async function getRoast() {
      try {
        const res = await fetch("/api/roast", { method: "POST" });
        const data = await res.json();
        return data.roast;
      } catch {
        return fallbackRoasts[Math.floor(Math.random() * fallbackRoasts.length)];
      }
    }

    /* ---------- GENERATE ROAST ---------- */
    generateBtn.addEventListener("click", async () => {
      if (!petImage.src) {
        alert("Upload a pet photo first üê∂");
        return;
      }

      roastText.textContent = "Roasting...";
      card.style.display = "block";
      downloadBtn.style.display = "block";
      reportBtn.style.display = "block";

      const roast = await getRoast();
      roastText.textContent = roast;
    });

    /* ---------- DOWNLOAD CARD ---------- */
    downloadBtn.addEventListener("click", async () => {
      await new Promise(resolve => setTimeout(resolve, 400));

      html2canvas(card, {
        backgroundColor: "#0b0b0f",
        scale: 2,
        useCORS: true
      }).then(canvas => {
        const link = document.createElement("a");
        link.download = "pawspace-pet-roast.png";
        link.href = canvas.toDataURL("image/png");
        link.click();

        setTimeout(() => {
          alert("Share it on Instagram or X üòà");
        }, 300);
      });
    });

    /* ---------- REPORT ---------- */
    reportBtn.addEventListener("click", () => {
      alert("Thanks for reporting. This image will be reviewed.");
    });
  </script>
</body>
</html>
